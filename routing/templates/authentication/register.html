{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block main %}
    <form method="POST" class="form-group" id="app">
        {% csrf_token %}
        {% include 'includes/errors.html' %}

        <div class="form-floating mb-3">
            {{ form.username }}
            <label for="username">Username*</label>
        </div>

        <div class="form-floating mb-3">
            {{ form.email }}
            <label for="email">Email*</label>
        </div>

        <div class="form-floating mb-3">
            {{ form.password1 }}
            <label for="password1">Password*</label>
            <div class="mt-2 d-flex gap-1 align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" :fill="this.validLen ? '#20c997' : '#6c757d'">
                    <path v-if="!validLen" d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                    <path v-else d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                </svg>
                <span :class="this.validLen ? 'text-valid' : 'text-muted'">It must contain at least 7 characters</span>
            </div>
            <div class="d-flex gap-1 align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px" :fill="this.notNumeric ? '#20c997' : '#6c757d'">
                    <path v-if="!notNumeric" d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                    <path v-else d="m424-296 282-282-56-56-226 226-114-114-56 56 170 170Zm56 216q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                </svg>
                <span :class="this.notNumeric ? 'text-valid' : 'text-muted'">It shouldn't be entirely numeric</span>
            </div>
        </div>

        <div class="form-floating mb-3">
            {{ form.password2 }}
            <label for="password2">Password confirmation*</label>
        </div>

        <button type="submit" class="btn btn-secondary">Register & Login</button>
    </form>
{% endblock %}

{% block rest %}
<script>
    new Vue({
        delimiters: ['[[', ']]'],
        el: '#app',
        data: {
            password1: '',
            validLen: false,
            notNumeric: false
        },
        methods: {
            isNumeric(str) {
                return /^\d+$/.test(str);
            }
        },
        watch: {
            password1(newVal) {
                this.validLen = newVal.length >= 7;
                this.notNumeric = !this.isNumeric(newVal) && newVal !== '';
            }
        }
    });
</script>
<style>
    .text-valid {
        color: #20c997;
    }
</style>
{% endblock %}